<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.31">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2022-08-27">

<title>jkrumbiegel.com – Pkg.jl and Julia Environments for Beginners</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">jkrumbiegel.com</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/jkrumbiegel"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Pkg.jl and Julia Environments for Beginners</h1>
  <div class="quarto-categories">
    <div class="quarto-category">julia</div>
  </div>
  </div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">August 27, 2022</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<p>When you start using Julia, you will quickly come in contact with Pkg.jl, its package manager. It’s reasonably easy to install a few packages and start using Julia. But from reading questions on Slack and Discourse, many users only start understanding relatively late what commands like <code>instantiate</code> are doing. This post should teach you how you can step beyond a messy global environment and towards neatly packaged local versions that allow you to collaborate more effectively and make your results reproducible.</p>
<section id="getting-started" class="level2">
<h2 class="anchored" data-anchor-id="getting-started">Getting started</h2>
<p>When you install Julia for the first time, there are no environments. Let’s say you installed Julia 1.8. When you start the REPL with the <code>julia</code> command, you will see the standard prompt</p>
<div class="ansiterminal sourceCode"><pre class="sourceCode code-with-copy"><code><span class="sgr-bold sgr-fg-3">julia&gt; </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>From there, you get to the Pkg.jl REPL mode by typing <code>]</code>. The prompt will change to indicate this, by showing the name of the active environment:</p>
<div class="ansiterminal sourceCode"><pre class="sourceCode code-with-copy"><code><span class="sgr-bold sgr-fg-5">(@v1.8) pkg&gt; </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>But wait, didn’t I just say there are no environments, yet? That’s true, there shouldn’t be any environment files on your computer. You can check the <code>.julia/environments</code> folder, it should be empty. This folder contains all your “shared” environments. You can tell that an environment is shared by the leading <code>@</code> character in the package REPL prompt, in our case <code>@v1.8</code> because we use Julia 1.8.</p>
<p>(Note that if you already have a folder called <code>v1.8</code>, or whatever Julia version you’re using, you can just rename that to <code>v1.8_deactivated</code> or something and restart Julia for the purposes of this tutorial.)</p>
<p>If a new environment is activated, this doesn’t yet create any files, and that’s why we don’t have any files in <code>.julia/environments</code>, yet. They only appear once you actually do something with your environment.</p>
<p>We can test this quickly. Activate a new environment by typing <code>(@v1.8) pkg&gt; activate MyEnvironment</code>. You won’t see any new files being created in your working directory, as I said this only happens once you manipulate an environment. But the prompt will have changed:</p>
<div class="ansiterminal sourceCode"><pre class="sourceCode code-with-copy"><code><span class="sgr-bold sgr-fg-5">(@v1.8) pkg&gt; </span><span>activate MyEnvironment
</span><span class="sgr-bold sgr-fg-3">  Activating</span><span> new project at `~/MyEnvironment`

</span><span class="sgr-bold sgr-fg-5">(MyEnvironment) pkg&gt; </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Let’s switch back to the “main” environment <code>@v1.8</code> for now.</p>
<p>The purpose of shared environments is that you can activate them easily from any working directory because they start with <code>@</code>, and Pkg knows to look for them in <code>.julia/environments</code>. For all other environments, you can activate them by name if you are in the directory where they were created, or you have to specify the full path.</p>
<p>So we activate <code>@v1.8</code> again by typing:</p>
<div class="ansiterminal sourceCode"><pre class="sourceCode code-with-copy"><code><span class="sgr-bold sgr-fg-5">(MyEnvironment) pkg&gt; </span><span>activate @v1.8
</span><span class="sgr-bold sgr-fg-3">  Activating</span><span> new project at `~/.julia/environments/v1.8`

</span><span class="sgr-bold sgr-fg-5">(@v1.8) pkg&gt; </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>As you see, Pkg told us we were activating a new project (another word for environment), because as we saw before, no files did actually exist, yet.</p>
<p>There’s another shortcut to activate the main environment, which is <code>activate</code> without an argument:</p>
<div class="ansiterminal sourceCode"><pre class="sourceCode code-with-copy"><code><span class="sgr-bold sgr-fg-5">(@v1.8) pkg&gt; </span><span>activate
</span><span class="sgr-bold sgr-fg-3">  Activating</span><span> new project at `~/.julia/environments/v1.8`

</span><span class="sgr-bold sgr-fg-5">(@v1.8) pkg&gt; </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="adding-a-package" class="level2">
<h2 class="anchored" data-anchor-id="adding-a-package">Adding a package</h2>
<p>Let’s add our first package to our shared <code>@v1.8</code> environment. For this, we use the <code>add</code> command. I choose the <code>MacroTools</code> package because it has few dependencies.</p>
<div class="ansiterminal sourceCode"><pre class="sourceCode code-with-copy"><code><span class="sgr-bold sgr-fg-5">(@v1.8) pkg&gt; </span><span>add MacroTools
</span><span class="sgr-bold sgr-fg-3">    Updating</span><span> registry at `~/.julia/registries/General.toml`
</span><span class="sgr-bold sgr-fg-3">   Resolving</span><span> package versions...
</span><span class="sgr-bold sgr-fg-3">    Updating</span><span> `~/.julia/environments/v1.8/Project.toml`
 </span><span class="sgr-fg-b1"> [1914dd2f] </span><span class="sgr-fg-b3">+ MacroTools v0.5.9</span><span>
</span><span class="sgr-bold sgr-fg-3">    Updating</span><span> `~/.julia/environments/v1.8/Manifest.toml`
 </span><span class="sgr-fg-b1"> [1914dd2f] </span><span class="sgr-fg-b3">+ MacroTools v0.5.9</span><span>
 </span><span class="sgr-fg-b1"> [2a0f44e3] </span><span class="sgr-fg-b3">+ Base64</span><span>
 </span><span class="sgr-fg-b1"> [d6f4376e] </span><span class="sgr-fg-b3">+ Markdown</span><span>
 </span><span class="sgr-fg-b1"> [9a3f8284] </span><span class="sgr-fg-b3">+ Random</span><span>
 </span><span class="sgr-fg-b1"> [ea8e919c] </span><span class="sgr-fg-b3">+ SHA v0.7.0</span><span>
 </span><span class="sgr-fg-b1"> [9e88b42a] </span><span class="sgr-fg-b3">+ Serialization</span><span>
</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>As you probably know, after doing this, the <code>MacroTools</code> code has been downloaded onto your system and you can use it in your own code:</p>
<div class="ansiterminal sourceCode"><pre class="sourceCode code-with-copy"><code><span class="sgr-bold sgr-fg-3">julia&gt; </span><span>using MacroTools</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>So what actually happened when we ran the <code>add</code> command?</p>
<p>In the first line, you can see that the general registry was updated. The general registry (<a href="https://github.com/JuliaRegistries/General">https://github.com/JuliaRegistries/General</a>) is a list of third-party packages that are available to the public, where each package lists all its dependencies and versions. There can be other registries, even private ones, but the general registry is the main one which will be the only one relevant for most users.</p>
<p>Pkg has first updated this list on our computer when we ran <code>add MacroTools</code> so that it knows about the most recent versions of all packages in the ecosystem. You can have a look at it in <code>.julia/registries/</code> if you want.</p>
<p>After updating the registry, Pkg is <code>Resolving package versions</code>. First, <code>MacroTools</code> latest version at the time of writing, <code>v0.5.9</code>, was added to <code>~/.julia/environments/v1.8/Project.toml</code>. So at this point in time, finally the environment file I was talking about earlier is being created.</p>
<p>We can look at the content of <code>Project.toml</code>:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode toml code-with-copy"><code class="sourceCode toml"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">[deps]</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="dt">MacroTools</span> <span class="op">=</span> <span class="st">"1914dd2f-81c6-5fcd-8719-6d5c9610ff09"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>So this just says that our environment has one dependency declared, which is <code>MacroTools.jl</code>. The UUID string <code>1914dd2f-81c6...</code> is there because that’s the “real” unique identifier of the package because, e.g., if another hypothetical registry had a different <code>MacroTools</code>, then at least you could specify the one you really want via the UUID.</p>
<p>Pkg also updated the file <code>~/.julia/environments/v1.8/Manifest.toml</code>. Let’s have a look at this one:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode toml code-with-copy"><code class="sourceCode toml"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This file is machine-generated - editing it directly is not advised</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="dt">julia_version</span> <span class="op">=</span> <span class="st">"1.8.0-rc3"</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="dt">manifest_format</span> <span class="op">=</span> <span class="st">"2.0"</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="dt">project_hash</span> <span class="op">=</span> <span class="st">"e39ab6d265da4acedccb7411db33219b8d7db4fc"</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="kw">[[deps.Base64]]</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="dt">uuid</span> <span class="op">=</span> <span class="st">"2a0f44e3-6c83-55bd-87e4-b1978d98bd5f"</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="kw">[[deps.MacroTools]]</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="dt">deps</span> <span class="op">=</span> <span class="op">[</span><span class="st">"Markdown"</span><span class="op">,</span> <span class="st">"Random"</span><span class="op">]</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="dt">git-tree-sha1</span> <span class="op">=</span> <span class="st">"3d3e902b31198a27340d0bf00d6ac452866021cf"</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="dt">uuid</span> <span class="op">=</span> <span class="st">"1914dd2f-81c6-5fcd-8719-6d5c9610ff09"</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="dt">version</span> <span class="op">=</span> <span class="st">"0.5.9"</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="kw">[[deps.Markdown]]</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="dt">deps</span> <span class="op">=</span> <span class="op">[</span><span class="st">"Base64"</span><span class="op">]</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="dt">uuid</span> <span class="op">=</span> <span class="st">"d6f4376e-aef5-505a-96c1-9c027394607a"</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a><span class="kw">[[deps.Random]]</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a><span class="dt">deps</span> <span class="op">=</span> <span class="op">[</span><span class="st">"SHA"</span><span class="op">,</span> <span class="st">"Serialization"</span><span class="op">]</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a><span class="dt">uuid</span> <span class="op">=</span> <span class="st">"9a3f8284-a2c9-5f02-9a11-845980a1fd5c"</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a><span class="kw">[[deps.SHA]]</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a><span class="dt">uuid</span> <span class="op">=</span> <span class="st">"ea8e919c-243c-51af-8825-aaa63cd721ce"</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a><span class="dt">version</span> <span class="op">=</span> <span class="st">"0.7.0"</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a><span class="kw">[[deps.Serialization]]</span></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a><span class="dt">uuid</span> <span class="op">=</span> <span class="st">"9e88b42a-f829-5b0c-bbe9-9e923198166b"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The <code>Manifest.toml</code> lists all the packages that were actually installed for you, while the <code>Project.toml</code> only lists the <code>MacroTools</code> dependency.</p>
<p>You can think of the two files this way:</p>
<ul>
<li><code>Project.toml</code>: What you want.</li>
<li><code>Manifest.toml</code>: What you get.</li>
</ul>
<p>The <code>Project.toml</code> is always the first file being edited when you make environment changes, if that is through the Pkg REPL or manually. The <code>Manifest.toml</code> is then the result of a computation that tries to find compatible versions of all packages specified in the <code>Project.toml</code> and their dependencies. Note that <code>Project.toml</code> can in principle specify impossible demands, like two packages that require incompatible dependencies. A <code>Manifest.toml</code> however should always be in a valid state, if no valid configuration of package dependencies can be resolved, you will just get an error.</p>
<p>We can see the dependency graph that Pkg resolved in the <code>Manifest.toml</code>, if we look at the <code>deps</code> fields:</p>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<svg width="672" height="480" viewbox="0.00 0.00 370.25 188.00" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" style="; max-width: none; max-height: none">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 184)">
<title>G</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-184 366.25,-184 366.25,4 -4,4"></polygon>
<!-- MacroTools -->
<g id="node1" class="node">
<title>MacroTools</title>
<ellipse fill="#b9d3ee" stroke="black" cx="110.41" cy="-162" rx="84.59" ry="18"></ellipse>
<text text-anchor="middle" x="110.41" y="-157.8" font-family="Times,serif" font-size="14.00">MacroTools v0.5.9</text>
</g>
<!-- Markdown -->
<g id="node2" class="node">
<title>Markdown</title>
<ellipse fill="tomato" stroke="black" cx="53.41" cy="-90" rx="53.33" ry="18"></ellipse>
<text text-anchor="middle" x="53.41" y="-85.8" font-family="Times,serif" font-size="14.00">Markdown</text>
</g>
<!-- MacroTools&#45;&gt;Markdown -->
<g id="edge1" class="edge">
<title>MacroTools-&gt;Markdown</title>
<path fill="none" stroke="black" d="M96.61,-144.05C89.68,-135.54 81.15,-125.07 73.51,-115.68"></path>
<polygon fill="black" stroke="black" points="76.11,-113.33 67.08,-107.79 70.68,-117.75 76.11,-113.33"></polygon>
</g>
<!-- Random -->
<g id="node3" class="node">
<title>Random</title>
<ellipse fill="tomato" stroke="black" cx="168.41" cy="-90" rx="43.52" ry="18"></ellipse>
<text text-anchor="middle" x="168.41" y="-85.8" font-family="Times,serif" font-size="14.00">Random</text>
</g>
<!-- MacroTools&#45;&gt;Random -->
<g id="edge2" class="edge">
<title>MacroTools-&gt;Random</title>
<path fill="none" stroke="black" d="M124.45,-144.05C131.61,-135.42 140.44,-124.76 148.31,-115.27"></path>
<polygon fill="black" stroke="black" points="151.22,-117.24 154.9,-107.31 145.83,-112.77 151.22,-117.24"></polygon>
</g>
<!-- Base64 -->
<g id="node4" class="node">
<title>Base64</title>
<ellipse fill="tomato" stroke="black" cx="53.41" cy="-18" rx="39.43" ry="18"></ellipse>
<text text-anchor="middle" x="53.41" y="-13.8" font-family="Times,serif" font-size="14.00">Base64</text>
</g>
<!-- Markdown&#45;&gt;Base64 -->
<g id="edge3" class="edge">
<title>Markdown-&gt;Base64</title>
<path fill="none" stroke="black" d="M53.41,-71.7C53.41,-63.98 53.41,-54.71 53.41,-46.11"></path>
<polygon fill="black" stroke="black" points="56.91,-46.1 53.41,-36.1 49.91,-46.1 56.91,-46.1"></polygon>
</g>
<!-- SHA -->
<g id="node5" class="node">
<title>SHA</title>
<ellipse fill="tomato" stroke="black" cx="167.41" cy="-18" rx="56.82" ry="18"></ellipse>
<text text-anchor="middle" x="167.41" y="-13.8" font-family="Times,serif" font-size="14.00">SHA v0.7.0</text>
</g>
<!-- Random&#45;&gt;SHA -->
<g id="edge4" class="edge">
<title>Random-&gt;SHA</title>
<path fill="none" stroke="black" d="M168.17,-71.7C168.06,-63.98 167.92,-54.71 167.8,-46.11"></path>
<polygon fill="black" stroke="black" points="171.3,-46.05 167.66,-36.1 164.3,-46.15 171.3,-46.05"></polygon>
</g>
<!-- Serialization -->
<g id="node6" class="node">
<title>Serialization</title>
<ellipse fill="tomato" stroke="black" cx="302.41" cy="-18" rx="59.68" ry="18"></ellipse>
<text text-anchor="middle" x="302.41" y="-13.8" font-family="Times,serif" font-size="14.00">Serialization</text>
</g>
<!-- Random&#45;&gt;Serialization -->
<g id="edge5" class="edge">
<title>Random-&gt;Serialization</title>
<path fill="none" stroke="black" d="M194.57,-75.34C214.52,-64.92 242.28,-50.41 264.64,-38.73"></path>
<polygon fill="black" stroke="black" points="266.29,-41.82 273.54,-34.08 263.05,-35.61 266.29,-41.82"></polygon>
</g>
</g>
</svg>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
<p>The blue node refers to the external package <code>MacroTools</code>, which has a version. The red nodes are standard libraries. Standard libraries are shipped with Julia, so they usually don’t have their own version and only change with each Julia release. You can look at the all the standard libraries in the <a href="https://github.com/JuliaLang/julia/tree/master/stdlib">Julia repository on GitHub</a>. Standard libraries can depend on other standard libraries. SHA is an unusual standard library because it’s hosted externally and has a version. But the version is still fixed for each Julia version via a <code>.version</code> file such as <a href="https://github.com/JuliaLang/julia/blob/master/stdlib/SHA.version">the one for SHA</a>, so most users can just treat it like a normal standard library. In this example, MacroTools depends only on standard libraries, but most other packages depend on other external packages as well.</p>
<p>You can check the versions of libraries in your <code>Project.toml</code> and <code>Manifest.toml</code> with the <code>status</code> or <code>st</code> command. With the <code>-m</code> flag you can see the <code>Manifest.toml</code> entries, which can be important for checking which dependencies were resolved.</p>
<div class="ansiterminal sourceCode"><pre class="sourceCode code-with-copy"><code><span class="sgr-bold sgr-fg-5">(@v1.8) pkg&gt; </span><span>st
</span><span class="sgr-bold sgr-fg-3">Status</span><span> `~/.julia/environments/v1.8/Project.toml`
 </span><span class="sgr-fg-b1"> [1914dd2f] </span><span>MacroTools v0.5.9

</span><span class="sgr-bold sgr-fg-5">(@v1.8) pkg&gt; </span><span>st -m
</span><span class="sgr-bold sgr-fg-3">Status</span><span> `~/.julia/environments/v1.8/Manifest.toml`
 </span><span class="sgr-fg-b1"> [1914dd2f] </span><span>MacroTools v0.5.9
 </span><span class="sgr-fg-b1"> [2a0f44e3] </span><span>Base64
 </span><span class="sgr-fg-b1"> [d6f4376e] </span><span>Markdown
 </span><span class="sgr-fg-b1"> [9a3f8284] </span><span>Random
 </span><span class="sgr-fg-b1"> [ea8e919c] </span><span>SHA v0.7.0
 </span><span class="sgr-fg-b1"> [9e88b42a] </span><span>Serialization

</span><span class="sgr-bold sgr-fg-5">(@v1.8) pkg&gt; </span><span>st -m SHA
</span><span class="sgr-bold sgr-fg-3">Status</span><span> `~/.julia/environments/v1.8/Manifest.toml`
 </span><span class="sgr-fg-b1"> [ea8e919c] </span><span>SHA v0.7.0
</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="version-numbers" class="level2">
<h2 class="anchored" data-anchor-id="version-numbers">Version numbers</h2>
<p>To understand how dependencies are resolved, you have to understand <a href="https://semver.org">SemVer versioning</a>. SemVer stands for semantic versioning, which just means that version numbers should be meaningful, not just random labels. The three parts of the version number are <code>major</code>.<code>minor</code>.<code>patch</code>. In Julia, all newer versions with the same major version should have compatible public APIs, so code that works with <code>v1.2.3</code> should also work with <code>v1.20.5</code>. The exception is major version <code>0</code>, where each new minor version can be considered potentially breaking. So code that works with <code>v0.2.4</code> should still work with <code>v0.2.13</code> but not necessarily with <code>v0.3.0</code>. This is because package developers want to be able to make breaking changes even if they haven’t brought their package to <code>v1.0</code> yet, a version that usually carries the implication of public API stability and is often reached only after the package has been around for a while.</p>
</section>
<section id="adding-specific-variants-of-a-package" class="level2">
<h2 class="anchored" data-anchor-id="adding-specific-variants-of-a-package">Adding specific variants of a package</h2>
<p>So far, we have only used the command <code>add MacroTools</code>, which pulled the latest version <code>v0.5.9</code> into our environment. Sometimes, however, you want a specific variant of a package. That doesn’t necessarily have to be a specific version. It can also be a commit or branch of a certain repository. Let’s try this out with <code>MacroTools</code>.</p>
<p>We can install the version <code>v0.5.1</code> by using the <code>@</code> syntax:</p>
<div class="ansiterminal sourceCode"><pre class="sourceCode code-with-copy"><code><span class="sgr-bold sgr-fg-5">(@v1.8) pkg&gt; </span><span>add MacroTools@0.5.1
</span><span class="sgr-bold sgr-fg-3">   Resolving</span><span> package versions...
</span><span class="sgr-bold sgr-fg-3">    Updating</span><span> `~/.julia/environments/v1.8/Project.toml`
</span><span class="sgr-fg-3">⌃</span><span class="sgr-fg-b1"> [1914dd2f] </span><span class="sgr-fg-b6">↓ MacroTools v0.5.9 ⇒ v0.5.1</span><span>
</span><span class="sgr-bold sgr-fg-3">    Updating</span><span> `~/.julia/environments/v1.8/Manifest.toml`
</span><span class="sgr-fg-4">⌅</span><span class="sgr-fg-b1"> [00ebfdb7] </span><span class="sgr-fg-b3">+ CSTParser v2.5.0</span><span>
</span><span class="sgr-fg-4">⌅</span><span class="sgr-fg-b1"> [34da2185] </span><span class="sgr-fg-b3">+ Compat v2.2.1</span><span>
</span><span class="sgr-fg-4">⌅</span><span class="sgr-fg-b1"> [864edb3b] </span><span class="sgr-fg-b3">+ DataStructures v0.17.20</span><span>
</span><span class="sgr-fg-3">⌃</span><span class="sgr-fg-b1"> [1914dd2f] </span><span class="sgr-fg-b6">↓ MacroTools v0.5.9 ⇒ v0.5.1</span><span>
 </span><span class="sgr-fg-b1"> [bac558e1] </span><span class="sgr-fg-b3">+ OrderedCollections v1.4.1</span><span>
 </span><span class="sgr-fg-b1"> [0796e94c] </span><span class="sgr-fg-b3">+ Tokenize v0.5.24</span><span>
 </span><span class="sgr-fg-b1"> [0dad84c5] </span><span class="sgr-fg-b3">+ ArgTools v1.1.1</span><span>
 </span><span class="sgr-fg-b1"> [56f22d72] </span><span class="sgr-fg-b3">+ Artifacts</span><span>
 </span><span class="sgr-fg-b1"> [ade2ca70] </span><span class="sgr-fg-b3">+ Dates</span><span>
 </span><span class="sgr-fg-b1"> [8bb1440f] </span><span class="sgr-fg-b3">+ DelimitedFiles</span><span>
 </span><span class="sgr-fg-b1"> [8ba89e20] </span><span class="sgr-fg-b3">+ Distributed</span><span>
 </span><span class="sgr-fg-b1"> [f43a241f] </span><span class="sgr-fg-b3">+ Downloads v1.6.0</span><span>
 </span><span class="sgr-fg-b1"> [7b1f6079] </span><span class="sgr-fg-b3">+ FileWatching</span><span>
 </span><span class="sgr-fg-b1"> [b77e0a4c] </span><span class="sgr-fg-b3">+ InteractiveUtils</span><span>
 </span><span class="sgr-fg-b1"> [b27032c2] </span><span class="sgr-fg-b3">+ LibCURL v0.6.3</span><span>
 </span><span class="sgr-fg-b1"> [76f85450] </span><span class="sgr-fg-b3">+ LibGit2</span><span>
 </span><span class="sgr-fg-b1"> [8f399da3] </span><span class="sgr-fg-b3">+ Libdl</span><span>
 </span><span class="sgr-fg-b1"> [37e2e46d] </span><span class="sgr-fg-b3">+ LinearAlgebra</span><span>
 </span><span class="sgr-fg-b1"> [56ddb016] </span><span class="sgr-fg-b3">+ Logging</span><span>
 </span><span class="sgr-fg-b1"> [a63ad114] </span><span class="sgr-fg-b3">+ Mmap</span><span>
 </span><span class="sgr-fg-b1"> [ca575930] </span><span class="sgr-fg-b3">+ NetworkOptions v1.2.0</span><span>
 </span><span class="sgr-fg-b1"> [44cfe95a] </span><span class="sgr-fg-b3">+ Pkg v1.8.0</span><span>
 </span><span class="sgr-fg-b1"> [de0858da] </span><span class="sgr-fg-b3">+ Printf</span><span>
 </span><span class="sgr-fg-b1"> [3fa0cd96] </span><span class="sgr-fg-b3">+ REPL</span><span>
 </span><span class="sgr-fg-b1"> [1a1011a3] </span><span class="sgr-fg-b3">+ SharedArrays</span><span>
 </span><span class="sgr-fg-b1"> [6462fe0b] </span><span class="sgr-fg-b3">+ Sockets</span><span>
 </span><span class="sgr-fg-b1"> [2f01184e] </span><span class="sgr-fg-b3">+ SparseArrays</span><span>
 </span><span class="sgr-fg-b1"> [10745b16] </span><span class="sgr-fg-b3">+ Statistics</span><span>
 </span><span class="sgr-fg-b1"> [fa267f1f] </span><span class="sgr-fg-b3">+ TOML v1.0.0</span><span>
 </span><span class="sgr-fg-b1"> [a4e569a6] </span><span class="sgr-fg-b3">+ Tar v1.10.0</span><span>
 </span><span class="sgr-fg-b1"> [8dfed614] </span><span class="sgr-fg-b3">+ Test</span><span>
 </span><span class="sgr-fg-b1"> [cf7118a7] </span><span class="sgr-fg-b3">+ UUIDs</span><span>
 </span><span class="sgr-fg-b1"> [4ec0a83e] </span><span class="sgr-fg-b3">+ Unicode</span><span>
 </span><span class="sgr-fg-b1"> [e66e0078] </span><span class="sgr-fg-b3">+ CompilerSupportLibraries_jll v0.5.2+0</span><span>
 </span><span class="sgr-fg-b1"> [deac9b47] </span><span class="sgr-fg-b3">+ LibCURL_jll v7.83.1+1</span><span>
 </span><span class="sgr-fg-b1"> [29816b5a] </span><span class="sgr-fg-b3">+ LibSSH2_jll v1.10.2+0</span><span>
 </span><span class="sgr-fg-b1"> [c8ffd9c3] </span><span class="sgr-fg-b3">+ MbedTLS_jll v2.28.0+0</span><span>
 </span><span class="sgr-fg-b1"> [14a3606d] </span><span class="sgr-fg-b3">+ MozillaCACerts_jll v2022.2.1</span><span>
 </span><span class="sgr-fg-b1"> [4536629a] </span><span class="sgr-fg-b3">+ OpenBLAS_jll v0.3.20+0</span><span>
 </span><span class="sgr-fg-b1"> [83775a58] </span><span class="sgr-fg-b3">+ Zlib_jll v1.2.12+3</span><span>
 </span><span class="sgr-fg-b1"> [8e850b90] </span><span class="sgr-fg-b3">+ libblastrampoline_jll v5.1.1+0</span><span>
 </span><span class="sgr-fg-b1"> [8e850ede] </span><span class="sgr-fg-b3">+ nghttp2_jll v1.47.0+0</span><span>
 </span><span class="sgr-fg-b1"> [3f19e933] </span><span class="sgr-fg-b3">+ p7zip_jll v17.4.0+0</span><span>
</span><span class="sgr-bold sgr-fg-7">        Info</span><span> Packages marked with </span><span class="sgr-fg-3">⌃</span><span> and </span><span class="sgr-fg-4">⌅</span><span> have new versions available, but those with </span><span class="sgr-fg-4">⌅</span><span> cannot be upgraded. To see why use `status --outdated -m`
</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>You can see that we got a ton of new dependencies. This happened because <code>MacroTools</code> managed to cut the number of packages it depends on a lot over time, so the older version pulls in much more.</p>
<p>If we take a look at the new <code>Manifest.toml</code> entry for <code>MacroTools</code>, we see:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode toml code-with-copy"><code class="sourceCode toml"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">[[deps.MacroTools]]</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="dt">deps</span> <span class="op">=</span> <span class="op">[</span><span class="st">"CSTParser"</span><span class="op">,</span> <span class="st">"Compat"</span><span class="op">,</span> <span class="st">"DataStructures"</span><span class="op">,</span> <span class="st">"Test"</span><span class="op">,</span> <span class="st">"Tokenize"</span><span class="op">]</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="dt">git-tree-sha1</span> <span class="op">=</span> <span class="st">"d6e9dedb8c92c3465575442da456aec15a89ff76"</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="dt">uuid</span> <span class="op">=</span> <span class="st">"1914dd2f-81c6-5fcd-8719-6d5c9610ff09"</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="dt">version</span> <span class="op">=</span> <span class="st">"0.5.1"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This just goes to show that even between patch versions of a package, which should all follow the same public API, the dependencies can change a lot.</p>
<p>If you look at the <code>Project.toml</code>, you will see that it hasn’t changed. The version requirement was just enforced during this one dependency resolution, and won’t be remembered or enforced again in future Pkg operations.</p>
<p>Let’s try one other syntax, which is the one for choosing a specific commit or branch from a repository. In this case, we use the commit <code>639d1a6</code>, but we could also use something like <code>master</code> to fetch the latest commit on that branch.</p>
<div class="ansiterminal sourceCode"><pre class="sourceCode code-with-copy"><code><span class="sgr-bold sgr-fg-5">(@v1.8) pkg&gt; </span><span>add MacroTools#639d1a6
</span><span class="sgr-bold sgr-fg-3">   Resolving</span><span> package versions...
</span><span class="sgr-bold sgr-fg-3">    Updating</span><span> `~/.julia/environments/v1.8/Project.toml`
 </span><span class="sgr-fg-b1"> [1914dd2f] </span><span class="sgr-fg-b4">~ MacroTools v0.5.1 ⇒ v0.5.9 `https://github.com/FluxML/MacroTools.jl.git#639d1a6`</span><span>
</span><span class="sgr-bold sgr-fg-3">    Updating</span><span> `~/.julia/environments/v1.8/Manifest.toml`
 </span><span class="sgr-fg-b1"> [00ebfdb7] </span><span class="sgr-fg-b2">- CSTParser v2.5.0</span><span>
 </span><span class="sgr-fg-b1"> [34da2185] </span><span class="sgr-fg-b2">- Compat v2.2.1</span><span>
 </span><span class="sgr-fg-b1"> [864edb3b] </span><span class="sgr-fg-b2">- DataStructures v0.17.20</span><span>
 </span><span class="sgr-fg-b1"> [1914dd2f] </span><span class="sgr-fg-b4">~ MacroTools v0.5.1 ⇒ v0.5.9 `https://github.com/FluxML/MacroTools.jl.git#639d1a6`</span><span>
 </span><span class="sgr-fg-b1"> [bac558e1] </span><span class="sgr-fg-b2">- OrderedCollections v1.4.1</span><span>
 </span><span class="sgr-fg-b1"> [0796e94c] </span><span class="sgr-fg-b2">- Tokenize v0.5.24</span><span>
 </span><span class="sgr-fg-b1"> [0dad84c5] </span><span class="sgr-fg-b2">- ArgTools v1.1.1</span><span>
 </span><span class="sgr-fg-b1"> [56f22d72] </span><span class="sgr-fg-b2">- Artifacts</span><span>
 </span><span class="sgr-fg-b1"> [ade2ca70] </span><span class="sgr-fg-b2">- Dates</span><span>
 </span><span class="sgr-fg-b1"> [8bb1440f] </span><span class="sgr-fg-b2">- DelimitedFiles</span><span>
 </span><span class="sgr-fg-b1"> [8ba89e20] </span><span class="sgr-fg-b2">- Distributed</span><span>
 </span><span class="sgr-fg-b1"> [f43a241f] </span><span class="sgr-fg-b2">- Downloads v1.6.0</span><span>
 </span><span class="sgr-fg-b1"> [7b1f6079] </span><span class="sgr-fg-b2">- FileWatching</span><span>
 </span><span class="sgr-fg-b1"> [b77e0a4c] </span><span class="sgr-fg-b2">- InteractiveUtils</span><span>
 </span><span class="sgr-fg-b1"> [b27032c2] </span><span class="sgr-fg-b2">- LibCURL v0.6.3</span><span>
 </span><span class="sgr-fg-b1"> [76f85450] </span><span class="sgr-fg-b2">- LibGit2</span><span>
 </span><span class="sgr-fg-b1"> [8f399da3] </span><span class="sgr-fg-b2">- Libdl</span><span>
 </span><span class="sgr-fg-b1"> [37e2e46d] </span><span class="sgr-fg-b2">- LinearAlgebra</span><span>
 </span><span class="sgr-fg-b1"> [56ddb016] </span><span class="sgr-fg-b2">- Logging</span><span>
 </span><span class="sgr-fg-b1"> [a63ad114] </span><span class="sgr-fg-b2">- Mmap</span><span>
 </span><span class="sgr-fg-b1"> [ca575930] </span><span class="sgr-fg-b2">- NetworkOptions v1.2.0</span><span>
 </span><span class="sgr-fg-b1"> [44cfe95a] </span><span class="sgr-fg-b2">- Pkg v1.8.0</span><span>
 </span><span class="sgr-fg-b1"> [de0858da] </span><span class="sgr-fg-b2">- Printf</span><span>
 </span><span class="sgr-fg-b1"> [3fa0cd96] </span><span class="sgr-fg-b2">- REPL</span><span>
 </span><span class="sgr-fg-b1"> [1a1011a3] </span><span class="sgr-fg-b2">- SharedArrays</span><span>
 </span><span class="sgr-fg-b1"> [6462fe0b] </span><span class="sgr-fg-b2">- Sockets</span><span>
 </span><span class="sgr-fg-b1"> [2f01184e] </span><span class="sgr-fg-b2">- SparseArrays</span><span>
 </span><span class="sgr-fg-b1"> [10745b16] </span><span class="sgr-fg-b2">- Statistics</span><span>
 </span><span class="sgr-fg-b1"> [fa267f1f] </span><span class="sgr-fg-b2">- TOML v1.0.0</span><span>
 </span><span class="sgr-fg-b1"> [a4e569a6] </span><span class="sgr-fg-b2">- Tar v1.10.0</span><span>
 </span><span class="sgr-fg-b1"> [8dfed614] </span><span class="sgr-fg-b2">- Test</span><span>
 </span><span class="sgr-fg-b1"> [cf7118a7] </span><span class="sgr-fg-b2">- UUIDs</span><span>
 </span><span class="sgr-fg-b1"> [4ec0a83e] </span><span class="sgr-fg-b2">- Unicode</span><span>
 </span><span class="sgr-fg-b1"> [e66e0078] </span><span class="sgr-fg-b2">- CompilerSupportLibraries_jll v0.5.2+0</span><span>
 </span><span class="sgr-fg-b1"> [deac9b47] </span><span class="sgr-fg-b2">- LibCURL_jll v7.83.1+1</span><span>
 </span><span class="sgr-fg-b1"> [29816b5a] </span><span class="sgr-fg-b2">- LibSSH2_jll v1.10.2+0</span><span>
 </span><span class="sgr-fg-b1"> [c8ffd9c3] </span><span class="sgr-fg-b2">- MbedTLS_jll v2.28.0+0</span><span>
 </span><span class="sgr-fg-b1"> [14a3606d] </span><span class="sgr-fg-b2">- MozillaCACerts_jll v2022.2.1</span><span>
 </span><span class="sgr-fg-b1"> [4536629a] </span><span class="sgr-fg-b2">- OpenBLAS_jll v0.3.20+0</span><span>
 </span><span class="sgr-fg-b1"> [83775a58] </span><span class="sgr-fg-b2">- Zlib_jll v1.2.12+3</span><span>
 </span><span class="sgr-fg-b1"> [8e850b90] </span><span class="sgr-fg-b2">- libblastrampoline_jll v5.1.1+0</span><span>
 </span><span class="sgr-fg-b1"> [8e850ede] </span><span class="sgr-fg-b2">- nghttp2_jll v1.47.0+0</span><span>
 </span><span class="sgr-fg-b1"> [3f19e933] </span><span class="sgr-fg-b2">- p7zip_jll v17.4.0+0</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Note that even though the version printed for MacroTools is again <code>0.5.9</code>, this doesn’t necessarily mean that we are on the same commit as the one pointed to by the version <code>0.5.9</code> in the registry. It just means that Pkg cloned the repository, checked out the commit with hash <code>639d1a6</code> and found the version specifier <code>0.5.9</code> in MacroTools’s own <code>Project.toml</code> file. Therefore, infinitely many code versions of a package can be treated as version <code>X.Y.Z</code> by Pkg, but <code>X.Y.Z</code> itself refers only to exactly one version. This distinction is important to remember when developing and editing a package, but more about that later.</p>
<p>If we take another look at our <code>Manifest.toml</code>, we can see the following entry for MacroTools:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode toml code-with-copy"><code class="sourceCode toml"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">[[deps.MacroTools]]</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="dt">deps</span> <span class="op">=</span> <span class="op">[</span><span class="st">"Markdown"</span><span class="op">,</span> <span class="st">"Random"</span><span class="op">]</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="dt">git-tree-sha1</span> <span class="op">=</span> <span class="st">"465a4803356bcb11f6eb97df992680f13a9ba776"</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="dt">repo-rev</span> <span class="op">=</span> <span class="st">"639d1a6"</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="dt">repo-url</span> <span class="op">=</span> <span class="st">"https://github.com/FluxML/MacroTools.jl.git"</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="dt">uuid</span> <span class="op">=</span> <span class="st">"1914dd2f-81c6-5fcd-8719-6d5c9610ff09"</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="dt">version</span> <span class="op">=</span> <span class="st">"0.5.9"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This time, the URL of the repository was recorded, as well as the revision, which was <code>639d1a6</code>. This is because as soon as you specify a revision in the <code>add</code> command, Pkg knows you’re operating outside of the registry, so it cannot rely on the repository information stored there for MacroTools.</p>
<p>(Note that you can also install unregistered packages, or forks of registered packages this way, by doing <code>add https://the_url_to_the_git_repository</code>.)</p>
<p>The manifest needs to store the url and revision in order to make the project reproducible by someone else. Let’s actually look at what reproducing an environment looks like:</p>
</section>
<section id="reproducing-an-environment" class="level2">
<h2 class="anchored" data-anchor-id="reproducing-an-environment">Reproducing an environment</h2>
<p>Let’s say you have written some code relying on the specific <code>MacroTools</code> version we added via <code>add MacroTools#639d1a6</code> and want your colleague to be able to run that code with the exact packages installed that we used at the time.</p>
<p>Which files do they need to reproduce the state of your environment? Not just the <code>Project.toml</code>, because remember, it still only contains this information:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>[deps]</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>MacroTools <span class="op">=</span> <span class="st">"1914dd2f-81c6-5fcd-8719-6d5c9610ff09"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We need to also send the <code>Manifest.toml</code> because it records the exact versions of all packages. Let’s pretend we are our colleague, and we just received a <code>Project.toml</code> and <code>Manifest.toml</code> file. How do we actually get the environment installed?</p>
<p>Let’s copy the files into a new folder we call <code>ColleagueEnv</code> in our current working directory.</p>
<p>To pretend we’re the colleague who just uses Julia for the first time, we also delete the <code>.julia/packages/MacroTools</code> folder in which the downloaded source code of <code>MacroTools</code> was stored.</p>
<p>Note that this means that the source code is not part of an environment but stored centrally. It would be pretty wasteful to download the same sources over and over just because you’re using different local environments.</p>
<p>Let’s now restart Julia and activate the <code>ColleagueEnv</code> environment:</p>
<div class="ansiterminal sourceCode"><pre class="sourceCode code-with-copy"><code><span class="sgr-bold sgr-fg-5">(@v1.8) pkg&gt; </span><span>activate ./ColleagueEnv
</span><span class="sgr-bold sgr-fg-3">  Activating</span><span> project at `~/ColleagueEnv`
</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We can check the installed packages via <code>st -m</code>:</p>
<div class="ansiterminal sourceCode"><pre class="sourceCode code-with-copy"><code><span class="sgr-bold sgr-fg-5">(ColleagueEnv) pkg&gt; </span><span>st -m
</span><span class="sgr-bold sgr-fg-3">Status</span><span> `~/ColleagueEnv/Manifest.toml`
</span><span class="sgr-fg-b2">→</span><span class="sgr-fg-b1"> [1914dd2f] </span><span>MacroTools v0.5.9 `https://github.com/FluxML/MacroTools.jl.git#master`
 </span><span class="sgr-fg-b1"> [2a0f44e3] </span><span>Base64
 </span><span class="sgr-fg-b1"> [d6f4376e] </span><span>Markdown
 </span><span class="sgr-fg-b1"> [9a3f8284] </span><span>Random
 </span><span class="sgr-fg-b1"> [ea8e919c] </span><span>SHA v0.7.0
 </span><span class="sgr-fg-b1"> [9e88b42a] </span><span>Serialization
</span><span class="sgr-bold sgr-fg-7">Info</span><span> Packages marked with </span><span class="sgr-fg-b2">→</span><span> are not downloaded, use `instantiate` to download
</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>If we were trying to just run some code using <code>MacroTools</code> now, this would happen:</p>
<div class="ansiterminal sourceCode"><pre class="sourceCode code-with-copy"><code><span class="sgr-bold sgr-fg-3">julia&gt; </span><span>using MacroTools
</span><span class="sgr-bold sgr-fg-b2">ERROR: </span><span>ArgumentError: Package MacroTools [1914dd2f-81c6-5fcd-8719-6d5c9610ff09] is required but does not seem to be installed:
 - Run `Pkg.instantiate()` to install all recorded dependencies.

Stacktrace:
 [1] </span><span class="sgr-bold">_require(</span><span class="sgr-fg-b1">pkg</span><span>::Base.PkgId</span><span class="sgr-bold">)</span><span>
</span><span class="sgr-fg-b1">   @ Base</span><span> </span><span class="sgr-fg-b1">./loading.jl:1306</span><span>
 [2] </span><span class="sgr-bold">_require_prelocked(</span><span class="sgr-fg-b1">uuidkey</span><span>::Base.PkgId</span><span class="sgr-bold">)</span><span>
</span><span class="sgr-fg-b1">   @ Base</span><span> </span><span class="sgr-fg-b1">./loading.jl:1200</span><span>
 [3] </span><span class="sgr-bold">macro expansion</span><span>
</span><span class="sgr-fg-b1">   @ ./loading.jl:1180 [inlined]</span><span>
 [4] </span><span class="sgr-bold">macro expansion</span><span>
</span><span class="sgr-fg-b1">   @ ./lock.jl:223 [inlined]</span><span>
 [5] </span><span class="sgr-bold">require(</span><span class="sgr-fg-b1">into</span><span>::Module, </span><span class="sgr-fg-b1">mod</span><span>::Symbol</span><span class="sgr-bold">)</span><span>
</span><span class="sgr-fg-b1">   @ Base</span><span> </span><span class="sgr-fg-b1">./loading.jl:1144</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>So we need to follow the advice already printed twice for us, and call <code>instantiate</code>. This will download everything specified in the <code>Manifest.toml</code> exactly as it was recorded there. You can actually be sure that it’s exactly the same because the <code>Manifest.toml</code> stores git tree hashes of each dependency. Unless someone deletes these specific parts of the repository you will be able to download the source exactly as it was:</p>
<div class="ansiterminal sourceCode"><pre class="sourceCode code-with-copy"><code><span class="sgr-bold sgr-fg-5">(ColleagueEnv) pkg&gt; </span><span>instantiate
</span><span class="sgr-bold sgr-fg-3">Precompiling</span><span> project...
</span><span class="sgr-fg-3">  ✓ </span><span>MacroTools
  1 dependency successfully precompiled in 1 seconds

</span><span class="sgr-bold sgr-fg-5">(ColleagueEnv) pkg&gt; </span><span>st -m
</span><span class="sgr-bold sgr-fg-3">Status</span><span> `~/ColleagueEnv/Manifest.toml`
 </span><span class="sgr-fg-b1"> [1914dd2f] </span><span>MacroTools v0.5.9 `https://github.com/FluxML/MacroTools.jl.git#master`
 </span><span class="sgr-fg-b1"> [2a0f44e3] </span><span>Base64
 </span><span class="sgr-fg-b1"> [d6f4376e] </span><span>Markdown
 </span><span class="sgr-fg-b1"> [9a3f8284] </span><span>Random
 </span><span class="sgr-fg-b1"> [ea8e919c] </span><span>SHA v0.7.0
 </span><span class="sgr-fg-b1"> [9e88b42a] </span><span>Serialization
</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Now we don’t get a warning anymore, our dependencies have been downloaded correctly. You will find <code>MacroTools</code> downloaded into the <code>.julia/packages</code> folder again.</p>
</section>
<section id="packages-and-environments" class="level2">
<h2 class="anchored" data-anchor-id="packages-and-environments">Packages and environments</h2>
<p>Packages and normal environments are pretty similar. Each package must have a <code>Project.toml</code> which specifies its name, UUID, version and dependencies. The easiest way to make a package to test this out, is to use the <code>generate</code> command of the Pkg REPL.</p>
<p>Let’s restart Julia and remove <code>MacroTools</code> from our main environment so it is empty:</p>
<div class="ansiterminal sourceCode"><pre class="sourceCode code-with-copy"><code><span class="sgr-bold sgr-fg-5">(@v1.8) pkg&gt; </span><span>rm MacroTools
</span><span class="sgr-bold sgr-fg-3">    Updating</span><span> `~/.julia/environments/v1.8/Project.toml`
 </span><span class="sgr-fg-b1"> [1914dd2f] </span><span class="sgr-fg-b2">- MacroTools v0.5.9 `https://github.com/FluxML/MacroTools.jl.git#639d1a6`</span><span>
</span><span class="sgr-bold sgr-fg-3">    Updating</span><span> `~/.julia/environments/v1.8/Manifest.toml`
 </span><span class="sgr-fg-b1"> [1914dd2f] </span><span class="sgr-fg-b2">- MacroTools v0.5.9 `https://github.com/FluxML/MacroTools.jl.git#639d1a6`</span><span>
 </span><span class="sgr-fg-b1"> [2a0f44e3] </span><span class="sgr-fg-b2">- Base64</span><span>
 </span><span class="sgr-fg-b1"> [d6f4376e] </span><span class="sgr-fg-b2">- Markdown</span><span>
 </span><span class="sgr-fg-b1"> [9a3f8284] </span><span class="sgr-fg-b2">- Random</span><span>
 </span><span class="sgr-fg-b1"> [ea8e919c] </span><span class="sgr-fg-b2">- SHA v0.7.0</span><span>
 </span><span class="sgr-fg-b1"> [9e88b42a] </span><span class="sgr-fg-b2">- Serialization</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Now, we generate a new package called <code>MyPackage</code>:</p>
<div class="ansiterminal sourceCode"><pre class="sourceCode code-with-copy"><code><span class="sgr-bold sgr-fg-5">(@v1.8) pkg&gt; </span><span>generate MyPackage
</span><span class="sgr-bold sgr-fg-3">  Generating</span><span>  project MyPackage:
    MyPackage/Project.toml
    MyPackage/src/MyPackage.jl
</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>As you can see, a <code>Project.toml</code> file was generated in the <code>MyPackage</code> directory.</p>
<p>Let’s have a look at this one:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode toml code-with-copy"><code class="sourceCode toml"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="dt">name</span> <span class="op">=</span> <span class="st">"MyPackage"</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="dt">uuid</span> <span class="op">=</span> <span class="st">"025f59cc-7e1c-467d-8f56-70157e1cbbbb"</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="dt">authors</span> <span class="op">=</span> <span class="op">[</span><span class="st">"Your Name &lt;your@email.com&gt;"</span><span class="op">]</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="dt">version</span> <span class="op">=</span> <span class="st">"0.1.0"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The only difference from a basic package environment to a normal environment are those four fields. If we want to use <code>MacroTools</code> in our package, we can add it manually to a <code>deps</code> section in the <code>Project.toml</code>, or we use the Pkg REPL. For that, we first activate the package as an environment, then we add <code>MacroTools</code>.</p>
<div class="ansiterminal sourceCode"><pre class="sourceCode code-with-copy"><code><span class="sgr-bold sgr-fg-5">(@v1.8) pkg&gt; </span><span>activate MyPackage/
</span><span class="sgr-bold sgr-fg-3">  Activating</span><span> project at `~/MyPackage`

</span><span class="sgr-bold sgr-fg-5">(MyPackage) pkg&gt; </span><span>add MacroTools
</span><span class="sgr-bold sgr-fg-3">    Updating</span><span> registry at `~/.julia/registries/General.toml`
</span><span class="sgr-bold sgr-fg-3">   Resolving</span><span> package versions...
</span><span class="sgr-bold sgr-fg-3">   Installed</span><span> MacroTools ─ v0.5.9
</span><span class="sgr-bold sgr-fg-3">    Updating</span><span> `~/MyPackage/Project.toml`
 </span><span class="sgr-fg-b1"> [1914dd2f] </span><span class="sgr-fg-b3">+ MacroTools v0.5.9</span><span>
</span><span class="sgr-bold sgr-fg-3">    Updating</span><span> `~/MyPackage/Manifest.toml`
 </span><span class="sgr-fg-b1"> [1914dd2f] </span><span class="sgr-fg-b3">+ MacroTools v0.5.9</span><span>
 </span><span class="sgr-fg-b1"> [2a0f44e3] </span><span class="sgr-fg-b3">+ Base64</span><span>
 </span><span class="sgr-fg-b1"> [d6f4376e] </span><span class="sgr-fg-b3">+ Markdown</span><span>
 </span><span class="sgr-fg-b1"> [9a3f8284] </span><span class="sgr-fg-b3">+ Random</span><span>
 </span><span class="sgr-fg-b1"> [ea8e919c] </span><span class="sgr-fg-b3">+ SHA v0.7.0</span><span>
 </span><span class="sgr-fg-b1"> [9e88b42a] </span><span class="sgr-fg-b3">+ Serialization</span><span>
</span><span class="sgr-bold sgr-fg-3">Precompiling</span><span> project...
</span><span class="sgr-fg-3">  ✓ </span><span>MacroTools
</span><span class="sgr-fg-3">  ✓ </span><span>MyPackage
  2 dependencies successfully precompiled in 1 seconds
</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The <code>Project.toml</code> now looks like this:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode toml code-with-copy"><code class="sourceCode toml"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="dt">name</span> <span class="op">=</span> <span class="st">"MyPackage"</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="dt">uuid</span> <span class="op">=</span> <span class="st">"025f59cc-7e1c-467d-8f56-70157e1cbbbb"</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="dt">authors</span> <span class="op">=</span> <span class="op">[</span><span class="st">"Your Name &lt;your@email.com&gt;"</span><span class="op">]</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="dt">version</span> <span class="op">=</span> <span class="st">"0.1.0"</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="kw">[deps]</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="dt">MacroTools</span> <span class="op">=</span> <span class="st">"1914dd2f-81c6-5fcd-8719-6d5c9610ff09"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>In the file <code>MyPackage/src/MyPackage.jl</code>, we can now import <code>MacroTools</code> and work with it. Let’s change the content of that file to:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">module</span> MyPackage</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> <span class="bu">MacroTools</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">test</span>()</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    MacroTools.<span class="pp">@capture</span> <span class="op">:</span>(<span class="fl">1</span> <span class="op">+</span> <span class="fl">2</span>) x_ <span class="op">+</span> y_</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@show</span> x</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@show</span> y</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span> <span class="co"># module MyPackage</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We can now <code>import</code> or <code>using</code> our package and verify that <code>MacroTools</code> can be used by its source code:</p>
<div class="ansiterminal sourceCode"><pre class="sourceCode code-with-copy"><code><span class="sgr-bold sgr-fg-3">julia&gt; </span><span>using MyPackage

</span><span class="sgr-bold sgr-fg-3">julia&gt; </span><span>MyPackage.test()
x = 1
y = 2
</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>That worked!</p>
</section>
<section id="the-develop-command" class="level2">
<h2 class="anchored" data-anchor-id="the-develop-command">The <code>develop</code> command</h2>
<p>Let’s restart Julia now, which will bring us back to the main environment. Let’s try again to import our package:</p>
<div class="ansiterminal sourceCode"><pre class="sourceCode code-with-copy"><code><span class="sgr-bold sgr-fg-3">julia&gt; </span><span>using MyPackage
</span><span class="sgr-bold sgr-fg-b2">ERROR: </span><span>ArgumentError: Package MyPackage not found in current path.
- Run `import Pkg; Pkg.add("MyPackage")` to install the MyPackage package.
Stacktrace:
 [1] </span><span class="sgr-bold">macro expansion</span><span>
</span><span class="sgr-fg-b1">   @ ./loading.jl:1163 [inlined]</span><span>
 [2] </span><span class="sgr-bold">macro expansion</span><span>
</span><span class="sgr-fg-b1">   @ ./lock.jl:223 [inlined]</span><span>
 [3] </span><span class="sgr-bold">require(</span><span class="sgr-fg-b1">into</span><span>::Module, </span><span class="sgr-fg-b1">mod</span><span>::Symbol</span><span class="sgr-bold">)</span><span>
</span><span class="sgr-fg-b1">   @ Base</span><span> </span><span class="sgr-fg-b1">./loading.jl:1144</span><span>
</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This doesn’t work, because our main environment doesn’t have <code>MyPackage</code> installed. You can use <code>MyPackage</code> as long as you have its own environment activated, but outside of that it is not visible.</p>
<p>We can change that by using the <code>develop</code> or <code>dev</code> command of the Pkg REPL, which will install and track <code>MyPackage</code>:</p>
<div class="ansiterminal sourceCode"><pre class="sourceCode code-with-copy"><code><span class="sgr-bold sgr-fg-5">(@v1.8) pkg&gt; </span><span>dev ./MyPackage/
</span><span class="sgr-bold sgr-fg-3">   Resolving</span><span> package versions...
</span><span class="sgr-bold sgr-fg-3">    Updating</span><span> `~/.julia/environments/v1.8/Project.toml`
 </span><span class="sgr-fg-b1"> [025f59cc] </span><span class="sgr-fg-b3">+ MyPackage v0.1.0 `../../../MyPackage`</span><span>
</span><span class="sgr-bold sgr-fg-3">    Updating</span><span> `~/.julia/environments/v1.8/Manifest.toml`
 </span><span class="sgr-fg-b1"> [1914dd2f] </span><span class="sgr-fg-b3">+ MacroTools v0.5.9</span><span>
 </span><span class="sgr-fg-b1"> [025f59cc] </span><span class="sgr-fg-b3">+ MyPackage v0.1.0 `../../../MyPackage`</span><span>
 </span><span class="sgr-fg-b1"> [2a0f44e3] </span><span class="sgr-fg-b3">+ Base64</span><span>
 </span><span class="sgr-fg-b1"> [d6f4376e] </span><span class="sgr-fg-b3">+ Markdown</span><span>
 </span><span class="sgr-fg-b1"> [9a3f8284] </span><span class="sgr-fg-b3">+ Random</span><span>
 </span><span class="sgr-fg-b1"> [ea8e919c] </span><span class="sgr-fg-b3">+ SHA v0.7.0</span><span>
 </span><span class="sgr-fg-b1"> [9e88b42a] </span><span class="sgr-fg-b3">+ Serialization</span><span>
</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Great, that worked. Now we can access <code>MyPackage</code> again:</p>
<div class="ansiterminal sourceCode"><pre class="sourceCode code-with-copy"><code><span class="sgr-bold sgr-fg-3">julia&gt; </span><span>using MyPackage
</span><span class="sgr-bold sgr-fg-7">[ Info: </span><span>Precompiling MyPackage [025f59cc-7e1c-467d-8f56-70157e1cbbbb]

</span><span class="sgr-bold sgr-fg-3">julia&gt; </span><span>MyPackage.test()
x = 1
y = 2
</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Why would we want to do this, use a separate environment to access our package environment? It’s because we probably want to use other packages that should not be dependencies of <code>MyPackage</code> while developing it. For example, a data analysis package could be developed while using a package like <a href="https://github.com/JuliaStats/RDatasets.jl">RDatasets.jl</a> which supplies test datasets.</p>
</section>
<section id="compatibility-bounds" class="level2">
<h2 class="anchored" data-anchor-id="compatibility-bounds">Compatibility bounds</h2>
<p>Currently, <code>MyPackage</code> does not specify the versions of <code>MacroTools</code> with which it is compatible. That is usually not a good idea, in fact, the general registry doesn’t allow packages to be registered if they don’t specify upper compatibility boundaries for each dependency. That makes sense because you don’t know if your package will be compatible with all future versions of your dependencies, so it makes sense to cap the compatibility to the point where you have tested everything works.</p>
<p>Let’s pretend we tested our package only up to <code>MacroTools</code> version <code>0.5.8</code>. We can write this requirement into the <code>Project.toml</code> of <code>MyPackage</code>:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode toml code-with-copy"><code class="sourceCode toml"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="dt">name</span> <span class="op">=</span> <span class="st">"MyPackage"</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="dt">uuid</span> <span class="op">=</span> <span class="st">"025f59cc-7e1c-467d-8f56-70157e1cbbbb"</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="dt">authors</span> <span class="op">=</span> <span class="op">[</span><span class="st">"Your Name &lt;your@email.com&gt;"</span><span class="op">]</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="dt">version</span> <span class="op">=</span> <span class="st">"0.1.0"</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="kw">[deps]</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="dt">MacroTools</span> <span class="op">=</span> <span class="st">"1914dd2f-81c6-5fcd-8719-6d5c9610ff09"</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="kw">[compat]</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="dt">MacroTools</span> <span class="op">=</span> <span class="st">"&lt;0.5.9"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>But this change is not picked up automatically by the <code>@v1.8</code> environment. To recompute the dependency graph and throw away the old <code>Manifest.toml</code>, we can run <code>update</code> or <code>up</code>:</p>
<div class="ansiterminal sourceCode"><pre class="sourceCode code-with-copy"><code><span class="sgr-bold sgr-fg-5">(@v1.8) pkg&gt; </span><span>up
</span><span class="sgr-bold sgr-fg-3">    Updating</span><span> registry at `~/.julia/registries/General.toml`
</span><span class="sgr-bold sgr-fg-3">   Installed</span><span> MacroTools ─ v0.5.8
</span><span class="sgr-bold sgr-fg-3">  No Changes</span><span> to `~/.julia/environments/v1.8/Project.toml`
</span><span class="sgr-bold sgr-fg-3">    Updating</span><span> `~/.julia/environments/v1.8/Manifest.toml`
</span><span class="sgr-fg-3">⌃</span><span class="sgr-fg-b1"> [1914dd2f] </span><span class="sgr-fg-b6">↓ MacroTools v0.5.9 ⇒ v0.5.8</span><span>
</span><span class="sgr-bold sgr-fg-7">        Info</span><span> Packages marked with </span><span class="sgr-fg-3">⌃</span><span> have new versions available
</span><span class="sgr-bold sgr-fg-3">Precompiling</span><span> project...
</span><span class="sgr-fg-4">  ✓ </span><span class="sgr-fg-b1">MacroTools</span><span>
</span><span class="sgr-fg-4">  ✓ </span><span>MyPackage
  2 dependencies successfully precompiled in 2 seconds
  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>As you can see, the MacroTools package was correctly downgraded to <code>v0.5.8</code>.</p>
<p>What would happen if we now tried to install <code>v0.5.9</code> into the main environment?</p>
<div class="ansiterminal sourceCode"><pre class="sourceCode code-with-copy"><code><span class="sgr-bold sgr-fg-5">(@v1.8) pkg&gt; </span><span>add MacroTools@0.5.9
</span><span class="sgr-bold sgr-fg-3">   Resolving</span><span> package versions...
</span><span class="sgr-bold sgr-fg-b2">ERROR: </span><span>Unsatisfiable requirements detected for package MacroTools [1914dd2f]:
 MacroTools [1914dd2f] log:
 ├─possible versions are: 0.4.3-0.5.9 or uninstalled
 ├─restricted to versions 0.0.0-0.5.8 by MyPackage [025f59cc], leaving only versions 0.4.3-0.5.8
 │ └─MyPackage [025f59cc] log:
 │   ├─possible versions are: 0.1.0 or uninstalled
 │   └─MyPackage [025f59cc] is fixed to version 0.1.0
 └─restricted to versions 0.5.9 by an explicit requirement — no versions left
</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We get a version compatibility conflict. It is not possible to reconcile the requirement of adding <code>MacroTools</code> <code>0.5.9</code> with the fact that it is only allowed to reach up to <code>0.5.8</code> for <code>MyPackage</code>.</p>
<p>Compatibility conflicts are the main reason why you should give each of your projects its own local environment instead of always using the global one. First of all, you’re more and more likely to end up with old versions or compatibility clashes, the more packages you install. Second, if you inadvertently update your main environment for project B, but later go back to project A, it could very well be that the new package versions are now incompatible with the code you wrote for A at the time. You don’t want to tangle all your projects up together, so just make separate environments for each.</p>
</section>
<section id="differences-between-add-and-develop" class="level2">
<h2 class="anchored" data-anchor-id="differences-between-add-and-develop">Differences between <code>add</code> and <code>develop</code></h2>
<p>In our examples, we have seen the <code>add</code> and <code>develop</code> commands when dealing with packages we want to install.</p>
<p>Both <code>add</code> and <code>dev</code> can be used to include packages in your environment. Both can take a local path, or the name of a registered package, or a link to a repository as sources. So why do we have two separate but similar commands?</p>
<p>The difference is that <code>add</code> treats packages as fixed, read-only resources. When you <code>add</code> a package, no matter if local or remote, each version is copied to an internal Julia folder where it should not be modified anymore.</p>
<p>When you <code>dev</code> a local package, it stays where it is and can be modified by you. You just have to remember to restart Julia to load any changes you make (unless they can be auto-reloaded by <a href="https://github.com/timholy/Revise.jl">Revise.jl</a>, which you should check out if you haven’t seen it yet), and to <code>update</code> the environment in case you make changes to the <code>Project.toml</code> like new dependencies or compatibility bounds. When you use <code>dev</code>, Julia is said to “track” that package.</p>
<p>Because you’re expected to make changes to code when you use <code>dev</code>, Julia copies packages that you <code>develop</code> for the first time by specifying its name or URL (for example <code>dev MacroTools</code> or <code>dev https://github.com/FluxML/MacroTools.jl</code>) into a special folder at <code>.julia/dev</code>. Here, you can access them with your editor of choice, make changes, and sync those back to GitHub or other version control systems.</p>
<p>Note that if you <code>dev MacroTools</code> in one local environment, and later <code>dev MacroTools</code> in a different environment, Julia will by default re-use the same repository at <code>.julia/dev</code>. If the first environment was already quite old and you haven’t pulled the new changes in a while, you’ll probably be surprised that you get that old version when you run <code>dev</code> in the fresh environment! Therefore, it can make sense to use separate local copies of packages you want to work on, if you anticipate that you will work on them in several different contexts. To do this, you can either clone a repository into a local folder, for example with <code>git clone https://github.com/FluxML/MacroTools.jl</code> and then run <code>dev the_local_folder</code>. The other option is running <code>dev --local MacroTools</code>, which copies the developed package into the working directory, not <code>.julia/dev</code>.</p>
</section>
<section id="stacked-environments" class="level2">
<h2 class="anchored" data-anchor-id="stacked-environments">Stacked environments</h2>
<p>There’s another behavior of environments that is potentially very confusing for beginners, and it’s called “stacked environments”. Let’s restart Julia again, and add the package <code>Infiltrator</code> to the main environment:</p>
<div class="ansiterminal sourceCode"><pre class="sourceCode code-with-copy"><code><span class="sgr-bold sgr-fg-5">(@v1.8) pkg&gt; </span><span>add Infiltrator
</span><span class="sgr-bold sgr-fg-3">    Updating</span><span> registry at `~/.julia/registries/General.toml`
</span><span class="sgr-bold sgr-fg-3">   Resolving</span><span> package versions...
</span><span class="sgr-bold sgr-fg-3">    Updating</span><span> `~/.julia/environments/v1.8/Project.toml`
 </span><span class="sgr-fg-b1"> [5903a43b] </span><span class="sgr-fg-b3">+ Infiltrator v1.6.1</span><span>
</span><span class="sgr-bold sgr-fg-3">    Updating</span><span> `~/.julia/environments/v1.8/Manifest.toml`
 </span><span class="sgr-fg-b1"> [5903a43b] </span><span class="sgr-fg-b3">+ Infiltrator v1.6.1</span><span>
 </span><span class="sgr-fg-b1"> [b77e0a4c] </span><span class="sgr-fg-b3">+ InteractiveUtils</span><span>
 </span><span class="sgr-fg-b1"> [3fa0cd96] </span><span class="sgr-fg-b3">+ REPL</span><span>
 </span><span class="sgr-fg-b1"> [6462fe0b] </span><span class="sgr-fg-b3">+ Sockets</span><span>
 </span><span class="sgr-fg-b1"> [cf7118a7] </span><span class="sgr-fg-b3">+ UUIDs</span><span>
 </span><span class="sgr-fg-b1"> [4ec0a83e] </span><span class="sgr-fg-b3">+ Unicode</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Now we activate the environment of <code>MyPackage</code>:</p>
<div class="ansiterminal sourceCode"><pre class="sourceCode code-with-copy"><code><span class="sgr-bold sgr-fg-5">(@v1.8) pkg&gt; </span><span>activate MyPackage
</span><span class="sgr-bold sgr-fg-3">  Activating</span><span> project at `~/MyPackage`
</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Let’s see what happens if we load <code>Infiltrator</code>:</p>
<div class="ansiterminal sourceCode"><pre class="sourceCode code-with-copy"><code><span class="sgr-bold sgr-fg-3">julia&gt; </span><span>using Infiltrator</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>It worked. But why? <code>Infiltrator</code> is not available in <code>MyPackage</code>’s Project.toml.</p>
<p>The reason is that Julia can import packages from multiple environments at the same time. This depends on the <code>LOAD_PATH</code> global variable. Let’s have a look:</p>
<div class="ansiterminal sourceCode"><pre class="sourceCode code-with-copy"><code><span class="sgr-bold sgr-fg-3">julia&gt; </span><span>LOAD_PATH
3-element Vector{String}:
 "@"
 "@v#.#"
 "@stdlib"
</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The first entry, <code>"@"</code>, means “active environment”, so the first place where Julia looked for Infiltrator was in <code>MyPackage</code>’s environment, where it didn’t find it.</p>
<p>The second entry, <code>"@v#.#"</code> means “the shared environment of this Julia version”, in our case this is <code>@v1.8</code>. That’s why I kept calling this the “main” environment, not only because it’s the default one, but also because it’s always available by default due to the <code>LOAD_PATH</code> configuration. This is where Julia found <code>Infiltrator</code> and loaded it.</p>
<p>The third entry, <code>"@stdlib"</code>, refers to the list of standard libraries that belongs to the current Julia version. This is the reason why we can do <code>using Statistics</code> or <code>using REPL</code> in a new Julia session, even if our main environment is empty.</p>
<p>One potential confusion comes from the fact that a user can activate a package environment and work there under the assumption that only package dependencies are available to import. This might hide the fact that some of the included packages are drawn in from the main environment, which will lead to an error later, if the package is installed to a new environment and can’t access the dependency anymore.</p>
<p>And there’s another, even trickier case. Let’s say you develop <code>DevelopingPackage</code> which depends on <code>HelperDependency</code> at version <code>3.0</code>. But for debugging, you also have installed <code>DebugPackage</code> in your main environment, which happens to depend on <code>HelperDependency</code> too, but compat bound to version <code>2.0</code>. Now, the main environment’s <code>Manifest.toml</code> will list <code>HelperDependency v2.0</code> and your package development environment will list <code>HelperDependency v3.0</code>. If you start Julia in the main environment and type <code>using DebugPackage</code>, Julia will also load <code>HelperDependency</code> at version <code>2.0</code> in the background. Now, you switch environments and type <code>using DevelopingPackage</code>. Julia will now try to load <code>DevelopingPackage</code> but it cannot load <code>HelperDependency v3.0</code> because <code>v2.0</code> is already loaded. Now you’ll get undefined behavior, because the package versions might be similar enough that you don’t notice anything, but they might be so different that you get <code>UndefVarErrors</code> or subtle bugs in behavior.</p>
<p>Because of these common footguns, the best practice is to use the main environment sparingly. <code>Infiltrator</code> is a good example for a package you can probably install there without issues. It’s a debugging package and rarely needed as a dependency for another package, and it doesn’t have non-standard-library dependencies, which means there’s no potential for the dependency loading issue mentioned above. On the other hand it’s very useful to have available without further effort when developing, so it can be a matter of convenience.</p>
<p>If you really want to make sure that only the packages from your currently activated project are accessible, you can remove other entries from the load path.</p>
<p>To demonstrate this, if we empty the load path we can’t load any package at all, neither <code>Infiltrator</code> from <code>@v1.8</code>, nor <code>MyPackage</code> from our active environment, nor the standard library <code>Statistics</code>:</p>
<div class="ansiterminal sourceCode"><pre class="sourceCode code-with-copy"><code><span class="sgr-bold sgr-fg-3">julia&gt; </span><span>empty!(LOAD_PATH)
String[]

</span><span class="sgr-bold sgr-fg-3">julia&gt; </span><span>using Infiltrator
</span><span class="sgr-fg-3"> │ </span><span>Package Infiltrator not found, but a package named Infiltrator is available
</span><span class="sgr-fg-3"> │ </span><span>from a registry. 
</span><span class="sgr-fg-3"> │ </span><span>Install package?
</span><span class="sgr-fg-3"> │   </span><span class="sgr-fg-5">(MyPackage) pkg&gt; </span><span>add Infiltrator 
</span><span class="sgr-fg-3"> └ </span><span>(y/n/o) [y]: </span><span class="sgr-bold sgr-fg-b2">ERROR: </span><span>ArgumentError: Package Infiltrator not found in current path, maybe you meant `import/using .Infiltrator`.
- Otherwise, run `import Pkg; Pkg.add("Infiltrator")` to install the Infiltrator package.

<span class="sgr-bold sgr-fg-3">julia&gt; </span><span>using MyPackage
</span><span class="sgr-bold sgr-fg-b2">ERROR: </span><span>ArgumentError: Package MyPackage not found in current path.
- Run `import Pkg; Pkg.add("MyPackage")` to install the MyPackage package.

<span class="sgr-bold sgr-fg-3">julia&gt; </span><span>using Statistics
</span><span class="sgr-bold sgr-fg-b2">ERROR: </span><span>ArgumentError: Package Statistics not found in current path.
- Run `import Pkg; Pkg.add("Statistics")` to install the Statistics package.
</span></span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="temporary-environments" class="level2">
<h2 class="anchored" data-anchor-id="temporary-environments">Temporary environments</h2>
<p>One thing that’s useful for quick tests are temporary environments. If you read about a new package and quickly want to try it, but don’t want to mess with your main environment or clutter your working directory with environment files, you can use <code>activate --temp</code>:</p>
<div class="ansiterminal sourceCode"><pre class="sourceCode code-with-copy"><code><span class="sgr-bold sgr-fg-5">(v1.8) pkg&gt; </span><span>activate --temp
</span><span class="sgr-bold sgr-fg-3">  Activating</span><span> new project at `/var/folders/z5/r5q6djwn5g10k3w279bn37700000gn/T/jl_e4klnB`

</span><span class="sgr-bold sgr-fg-5">(jl_e4klnB) pkg&gt; </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This environment will only exist until the Julia process exits, so it’s perfect to run something once and then forget about it.</p>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>This was a short tour of <code>Pkg</code> and its main functions. I hope it has become more clear how environments work and why you shouldn’t rely on a single global one. It’s quite easy to make one environment per project and the text files created use effectively no space, so there’s no downside to doing this.</p>
<p>For more info, have a look at some of these sources:</p>
<ul>
<li><a href="https://pkgdocs.julialang.org/v1/">Pkg.jl documentation</a>.</li>
<li><a href="https://juliadynamics.github.io/DrWatson.jl/stable/">DrWatson.jl</a>, a tool that tries to make the process of setting up reproducible projects easier.</li>
<li><a href="https://github.com/JuliaTesting/TestEnv.jl">TestEnv.jl</a> which helps with the problem of stacked environments in the context of tests (not covered here).</li>
<li><a href="https://github.com/invenia/PkgTemplates.jl">PkgTemplates.jl</a> which makes creating packages easier.</li>
</ul>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/jkrumbiegel\.com");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>